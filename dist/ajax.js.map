{"version":3,"sources":["src/ajax.es6"],"names":[],"mappings":"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","file":"src/ajax.es6","sourcesContent":["var defaultOptions = {\n  'async': true,\n  'timeout': 1000 * 60,\n  'responseType': 'application/json',\n  'headers': {\n    'Content-type': 'application/x-www-form-urlencoded'\n  }\n}\n\n/**\n * A XMLHttpRequest wrapper.\n * @class\n */\nexport class Ajax {\n  /**\n   * Exec a XMLHttpRequest.\n   *\n   * ## Options definition\n   * - {String} url The requested url.\n   * - {Object} headers A set of headers to set (key => value).\n   * - {String} responseType The response type mime.\n   * - {Number} timeout A value for request timeout (0 => no timeout).\n   * - {Function} notify A callback function for progress event.\n   * - {Boolean} async Should exec the request asynchronously.\n   * @static\n   * @param {Object|String} options A set of options (or the url) for the XMLHttpRequest\n   * @return Promise\n   */\n  static request(options = {}) {\n    return new Promise(function(resolve, reject) {\n      var XHR = window.XMLHttpRequest || ActiveXObject;\n      var request = new XHR('MSXML2.XMLHTTP.3.0');\n      var resolved = false;\n      if (typeof options == 'string') {\n        options = { 'url': options };\n      }\n      for (var k in Ajax.defaultOptions) {\n        if (options[k] !== undefined) {\n          options[k] = Ajax.defaultOptions[k];\n        }\n      }\n      request.open(options.method || 'GET', options.url, !!options.async);\n      if (options.header) {\n        for (var k in options.header) {\n          request.setRequestHeader(k, options.header[k]);\n        }\n      }\n\n      if (options.responseType) {\n        request.responseType = options.responseType;\n      }\n\n      request.onreadystatechange = function () {\n        if (request.readyState === 4) {\n          var parse = function (req) {\n            var result;\n            if (typeof req.response == 'string' && typeof req.responseText == 'string') {\n              try {\n                result = JSON.parse(req.responseText);\n              } catch (e) {\n                result = req.responseText;\n              }\n            } else {\n              result = req.response;\n            }\n            return result;\n          }\n          resolved = true;\n          if (request.status === 200 || request.status === 304) {\n            resolve(parse(request));\n          } else {\n            reject(request);\n          }\n        }\n      }\n\n      request.onerror = function(er) {\n        resolved = true;\n        reject(request);\n      }\n\n      request.onabort = function(er) {\n        resolved = true;\n        reject(request);\n      }\n\n      request.addEventListener('progress', function(e) {\n          var done = e.loaded || e.position, \n              total = e.total || e.totalSize;\n\n          if (typeof options.notify == 'function') {\n            options.notify(done, total);\n          }\n      }, false);\n      if (request.upload) {\n          request.upload.onprogress = function(e) {\n              var done = e.loaded || e.position,\n                  total = e.total || e.totalSize;\n              if (typeof options.notify == 'function') {\n                options.notify(done, total);\n              }\n          };\n      }\n\n      if (options.timeout) {\n        setTimeout(function() {\n          if (!resolved) {\n            request.timeout = true;\n            request.status = 0;\n            reject(request);\n          }\n        }, options.timeout);\n      }\n\n      try {\n        if (options.data !== undefined) {\n          request.send(options.data);\n        } else {\n          request.send();\n        }\n      } catch(ex) {\n        resolved = true;\n        reject(request);\n      }\n    });\n  }\n  /**\n   * Exec a XMLHttpRequest with method HEAD.\n   * @static\n   * @param {String} url the url for the XMLHttpRequest\n   * @param {Object} options A set of options for the XMLHttpRequest\n   * @return Promise\n   */\n  static head(url, options = {}) {\n    options['url'] = url;\n    options['method'] = 'HEAD';\n    return Ajax.request(options);\n  }\n  /**\n   * Exec a XMLHttpRequest with method GET.\n   * @static\n   * @param {String} url the url for the XMLHttpRequest\n   * @param {Object} options A set of options for the XMLHttpRequest\n   * @return Promise\n   */\n  static get(url, options = {}) {\n    options['url'] = url;\n    options['method'] = 'GET';\n    return Ajax.request(options);\n  }\n  /**\n   * Exec a XMLHttpRequest with method POST.\n   * @static\n   * @param {String} url the url for the XMLHttpRequest\n   * @param {Object} options A set of options for the XMLHttpRequest\n   * @param {Object} data The data to send in the POST request\n   * @return Promise\n   */\n  static post(url, options = {}, data) {\n    options['url'] = url;\n    options['method'] = 'POST';\n    if (data !== undefined) {\n      options['data'] = data;\n    }\n    return Ajax.request(options);\n  }\n  /**\n   * Exec a XMLHttpRequest with method PUT.\n   * @static\n   * @param {String} url the url for the XMLHttpRequest\n   * @param {Object} options A set of options for the XMLHttpRequest\n   * @param {Object} data The data to send in the PUT request\n   * @return Promise\n   */\n  static put(url, options = {}, data) {\n    options['url'] = url;\n    options['method'] = 'PUT';\n    if (data !== undefined) {\n      options['data'] = data;\n    }\n    return Ajax.request(options);\n  }\n  /**\n   * Exec a XMLHttpRequest with method DELETE.\n   * @static\n   * @param {String} url the url for the XMLHttpRequest\n   * @param {Object} options A set of options for the XMLHttpRequest\n   * @return Promise\n   */\n  static delete(url, options = {}) {\n    options['url'] = url;\n    options['method'] = 'DELETE';\n    return Ajax.request(options);\n  }\n\n}\n\nAjax.defaultOptions = defaultOptions;"]}